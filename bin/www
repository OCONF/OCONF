#!/usr/bin/env node
// var debug = require('debug')('MODULE_NAME');
var app = require('../app');
var fs = require('fs');

app.set('port', process.env.PORT || 3000);

var options = {
  key:  fs.readFileSync('keys/server.key'),
  cert: fs.readFileSync('keys/server.crt')
};

var server = require('https').Server(options, app);

server.listen(app.get('port'), function() {
  console.log('Express server listening on port ' + server.address().port);
});

require('../node_modules/rtcmulticonnection-v3/Signaling-Server.js')(server, function(socket) {
    try {
        var params = socket.handshake.query;

        // "socket" object is totally in your own hands!
        // do whatever you want!

        // in your HTML page, you can access socket as following:
        // connection.socketCustomEvent = 'custom-message';
        // var socket = connection.getSocket();
        // socket.emit(connection.socketCustomEvent, { test: true });

        if (!params.socketCustomEvent) {
            params.socketCustomEvent = 'custom-message';
        }

        socket.on(params.socketCustomEvent, function(message) {
            try {
                socket.broadcast.emit(params.socketCustomEvent, message);
            } catch (e) {}
        });
    } catch (e) {}
});
